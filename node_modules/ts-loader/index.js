console.trace();

var {Parser} = require('acorn');
var stage3 = require('acorn-stage3');

var Module = require("module")
var filepath = require.resolve("webpack")
var acornPath = Module._resolveFilename("acorn", {
    paths: Module._nodeModulePaths(filepath),
    filename: filepath,
    id: filepath,
});
var webpackAcorn = require(acornPath)
var stage3Parser = Parser.extend(stage3)
console.log(acornPath + webpackAcorn.Parser.parse)
webpackAcorn.Parser.parse = function(code, options) {
    console.log("=================", options.ecmaVersion);
    // stage3Parser.parse(code, options)
    console.log("------------=====", options.ecmaVersion);
    options.ecmaVersion = 2020
    try {
        return stage3Parser.parse(code, options)
    } catch(e) {
        console.error(e)
        console.log(code)
        console.log(options)
        process.exit()
    }
    // console.trace()
    // console.log("=================456--------------456");
    // console.log(code)
    // return stage3Parser.parse(code, options)
}


// Parser.extend(stage3).parse('100_000n');
 
var loader = require('./dist');

module.exports = loader;